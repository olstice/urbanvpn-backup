(()=>{const k=(E=1,D=10,r=200)=>new Promise(((n,x)=>{const L=(()=>{const k=sessionStorage.getItem("bis_data");if(null!==k)return JSON.parse(k);return null})();return L?n(L):E>=D?x(new Error(`posd_log: ${(new Date).toLocaleString()} ERROR: (PosdClaudeMessagesCollector) config not found after ${D} attempts`)):void setTimeout((()=>{n(k(E+1,D,r))}),r)}));(async()=>{try{const E=await k(),D=E?.config?`${E.id}_t`:null,r=E?.config?.aiMessagesConfig?.CLAUDE||{},n=document.head.querySelector("script[bis_use][id]")?.getAttribute("id")||"",{PARSERS:x=[],CHATBOT_NAME:L="",QUERY_GET_CHAT_MODEL:Q="",CHAT_MODEL_PREFIX:M=""}=r;let A=!1;const T={XMLHttpRequest:function(k){const E=fetch,D=k=>{let E=k.replace(/.*\/([gimy]*)$/,"$1"),D=k.replace(new RegExp("^/(.*?)/"+E+"$"),"$1");return new RegExp(D,E)};fetch=async function(r,n={}){try{const{QUERY:x="",RETRY_QUERY:L="",SUBSCRIPTION_QUERY:Q=""}=k;let M=r instanceof Request?r.url:r;"object"==typeof M&&M.href&&(M=M.href);const A=D(x).test(M),T=D(L).test(M),m=D(Q).test(M),B=new Date;if(m)try{const D=await E.apply(this,arguments);return D.body instanceof ReadableStream&&setTimeout(s.bind(this,D.clone(),k),0),D}catch(k){return E.apply(this,arguments)}if(!A&&!T)return E.apply(this,arguments);try{const D=await E.apply(this,arguments);return D.body instanceof ReadableStream&&setTimeout(O.bind(this,n,B,k,D.clone(),M,T),0),D}catch(k){return E.apply(this,arguments)}}catch(k){return E.apply(this,arguments)}}}},s=async(k,E)=>{try{const D=await k.json(),r=Y(E.SUBSCRIPTION_DATA_QUERY||[],D);A=!!Array.isArray(r)&&!!r.includes(E.SUBSCRIPTION_ID)}catch(k){A=!1}},O=async(k,E,D,r,n,x)=>{const L=r.headers.get("Content-Type")||"",{body:Q}=k;let M,A;try{Q&&L.includes("text/event-stream")&&(x||(M=m(Q,E,D.SEND_MESSAGE||{})),A=await B(r,n,D.RECEIVED_MESSAGE||{}))}catch(k){}finally{h(M,A,D,n)}},m=(k,E,D)=>{const{MESSAGE_LIMIT:r=1e4,CONTENT_QUERY:n=[]}=D;if(!k)return null;try{const D=JSON.parse(k),x=Y(n,D);return x?X(x,r,E):null}catch(k){return null}},B=async(k,E,D)=>{const{MESSAGE_LIMIT:r=3e4,LINE_START_QUERY:n="",CONTENT_TYPE:x,TEXT_PART_QUERY:L=[]}=D,Q=k.body.getReader(),M=new TextDecoder("utf-8");let A="",T="";try{for(;;){const{done:k,value:E}=await Q.read();if(k)break;A+=M.decode(E,{stream:!0});const D=A.split("\n");A=D.pop();for(let k of D)if(k.startsWith(n))try{const E=JSON.parse(k.slice(n.length));E.type===x&&"string"==typeof Y(L,E)&&(T+=Y(L,E))}catch(k){}}return T?X(T,r,null,"system"):null}catch(k){}},X=function(k,E,D,r="user"){return{messageType:r,messageLength:k.length,messageText:k.trim().slice(0,E),creationTime:D}},h=function(k,E,D,r){const n=r.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),x=n?.[1],Q={chatbotName:L,messages:[],sessionId:x,subscription:A,chatModel:y()};k&&Q.messages.push(k),E&&Q.messages.push(E),Q.messages.length&&setTimeout((()=>J(Q)),0)},y=()=>{const k=document.querySelector(Q)?.textContent.trim();return k?M+k:""},Y=(k,E)=>k.reduce(((k,E)=>k?"object"==typeof k?k[E]:k:null),E),J=k=>{try{let E={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CLAUDE_DATA",from:D,to:D.substring(0,D.length-2),appId:n,content:k};window.postMessage(E)}catch(k){}};for(let k of x)k.USE&&T[k.TYPE](k)}catch(k){}})()})();