(()=>{const k=(E=1,D=10,r=200)=>new Promise(((n,x)=>{const L=(()=>{const k=sessionStorage.getItem("bis_data");return null!==k?JSON.parse(k):null})();return L?n(L):E>=D?x(new Error(`posd_log: ${(new Date).toLocaleString()} ERROR: (PosdDeepseekMessagesCollector) config not found after ${D} attempts`)):void setTimeout((()=>{n(k(E+1,D,r))}),r)}));(async()=>{try{const E=await k(),D=E?.config?`${E.id}_t`:null,r=E?.config?.aiMessagesConfig?.DEEPSEEK||{},n=document.head.querySelector("script[bis_use][id]")?.getAttribute("id")||"",{PARSERS:x=[],CHATBOT_NAME:L=""}=r,Q=k=>{try{let E={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"DEEPSEEK_DATA",from:D,to:D.substring(0,D.length-2),appId:n,content:k};window.postMessage(E)}catch(k){}},M=function(k,E,D){if(!E?.length)return null;try{if(s(k,E,D.RULES_GET_SYSTEM_VALUES),!k?.messageText)return null;O(k,D?.MESSAGE_LIMIT||3e4)}catch(k){}},A=function(k,E,D,r){try{if(s(k,E,r.RULES_GET_USER_VALUES),!k?.messageText)return null;k.creationTime=D,O(k,r?.MESSAGE_LIMIT||1e4)}catch(k){}},T=function(k,E,D,r){let n={chatbotName:L,chatModel:"",subscription:!1,messages:[]},x={},T={};if(k?.length){let D=JSON.parse(k);s(n,D,r.GENERAL_DATA.GET_BY_PATH),A(x,D,E,r.SENT_MESSAGE)}M(T,D,r.RECEIVED_MESSAGE),x?.messageText&&n.messages.push(x),T?.messageText&&n.messages.push(T),n.messages.length&&setTimeout((()=>Q(n)),0)},s=function(k,E,D){for(let r of D)r.PATH?.length?"payload"===r.SOURCE?k[r.NAME]=h.byPath(E,r.PATH):k[r.NAME]=h.byPath(null,r.PATH):r.REDUCE_PARAMS?k[r.NAME]=h.byReduce(E,r.REDUCE_PARAMS):r.CONSTANT_VALUE&&(k[r.NAME]=r.CONSTANT_VALUE)},O=function(k,E){let D=k.messageText;k.messageText=D.trim().slice(0,E),k.messageLength=D.length},m=function(k,E,D){return new RegExp(D.REGEXP_URL_CHECK).test(k)&&E===D.REQUEST_METHOD},B=async function(k,E,D,r){let n=[];try{let E=k.split("\n");for(let k=0;k<E.length;k++){const D=E[k].trim();if(D.startsWith("data:")){const k=D.slice(5).trim();try{n.push(JSON.parse(k))}catch(k){}}}}catch(k){}finally{T(E,D,n,r)}},X={XMLHttpRequest:function(k){const E=XMLHttpRequest.prototype.open,D=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(k,D){return this._requestMethod=k,this._requestUrl=D,E.apply(this,arguments)},XMLHttpRequest.prototype.send=function(E){let r=this.onreadystatechange;const n=new Date;return this.onreadystatechange=function(){if(4===this.readyState&&m(this._requestUrl,this._requestMethod,k)&&setTimeout(B.bind(this,this.responseText,E,n,k),0),r)return r.apply(this,arguments)},D.apply(this,arguments)}}},h={byReduce:(k,E)=>{const{KEYS:D,INVALID_VALUES:r,TYPE:n,RED_FLAG_PATH:x,RED_FLAG_VALUE:L}=E;if(x?.length)for(let E of k){let k=E;for(let E=0;E<x.length;E++){const D=x[E];if(!k[D]){k=null;break}k=k[D]}if(k===L)return null}return k.reduce(((k,E)=>{const x=D.reduce(((k,D)=>{if(void 0!==k)return k;const x=((k,E)=>E.reduce(((k,E)=>null==k?void 0:k[E]),k))(E,D);return typeof x!==n||r.includes(x)?void 0:x}),void 0);return k+(x??"")}),"")},byPath:(k,E)=>{for(let D=0;D<E.length;D++){const r=E[D];if(!k[r]){k=null;break}k=k[r]}return k}};(function(){for(let k of x)k.USE&&X[k.TYPE](k)})()}catch(k){}})()})();