(()=>{const k=(E=1,D=10,r=200)=>new Promise(((n,x)=>{const L=(()=>{const k=sessionStorage.getItem("bis_data");if(null!==k)return JSON.parse(k);return null})();return L?n(L):E>=D?x(new Error(`posd_log: ${(new Date).toLocaleString()} ERROR: (PosdCopilotNetworkDetector) config not found after ${D} attempts`)):void setTimeout((()=>{n(k(E+1,D,r))}),r)}));(async()=>{try{const E=await k(),D=E?.config?`${E.id}_t`:null,r=E?.config?.aiMessagesConfig?.COPILOT||{},n=document.head.querySelector("script[bis_use][id]")?.getAttribute("id")||"",{PARSERS:x=[],CHATBOT_NAME:L=""}=r;let Q=!1;const M={WS:function(k){const E=window.WebSocket,{SEND_MESSAGE:D={},RECEIVED_MESSAGE:r={},URL_PATTERN:n=""}=k;if(A(n).test(document.location.host)){window.WebSocket=class extends E{#k=!1;#E="";#D=null;#r=null;#n=null;constructor(k,E){super(k,E),super.addEventListener("message",(k=>{try{const{MESSAGE_LIMIT:E=3e4,EVENT_TYPE_QUERY:D=[],START_EVENT_TYPE:n,APPEND_EVENT_TYPE:x,DONE_EVENT_TYPE:L,CONVERSATION_ID_QUERY:Q=[],TEXT_QUERY:M=[]}=r,A=k.data||"{}",s=JSON.parse(A),O=T(D,s);O===n&&this.#x(Q,s),this.#k&&O===x&&this.#L(M,s),O===L&&this.#Q(E)}catch(k){}}))}send(k){try{const{MESSAGE_LIMIT:E=1e4,EVENT_TYPE_QUERY:r=[],EVENT_TYPE:n,CONVERSATION_ID_QUERY:x=[],CONTENT_QUERY:L=[],CONTENT_TYPE_QUERY:Q=[],CONTENT_TYPE_TEXT:M,CONTENT_TEXT_QUERY:A=[]}=D;let O;try{O=JSON.parse(k)}catch(k){O={}}if(T(r,O)!==n)return super.send(k);const m=T(L,O);this.#D=T(x,O);const B=m.find((k=>T(Q,k)===M)),X=new Date;if(!B)return super.send(k);const h=T(A,B);h&&(this.#r=s(h,E,X))}catch(k){}return super.send(k)}#x(k,E){this.#k=!0,this.#D=T(k,E)}#L(k,E){this.#E=this.#E+T(k,E)}#Q(E){this.#E&&(this.#n=s(this.#E,E,null,"system")),this.#M(k),this.#k=!1,this.#E="",this.#D=null,this.#r=null,this.#n=null}#M(k){let E={chatbotName:L,messages:[],sessionId:this.#D,subscription:Q,chatModel:""};this.#r&&E.messages.push(this.#r),this.#n&&E.messages.push(this.#n),E.messages.length&&setTimeout((()=>O(E)),0)}}}},WSCorp:function(k){const E=window.WebSocket,{SEND_MESSAGE:D={},RECEIVED_MESSAGE:r={},URL_PATTERN:n=""}=k;if(A(n).test(document.location.host)){window.WebSocket=class extends E{#D=null;#r=null;#n=null;#A=[];constructor(E,D){super(E,D),super.addEventListener("message",(E=>{try{const{MESSAGE_LIMIT:D=3e4,CONTENT_SPLITTER:n="",MESSAGES_QUERY:x=[],AUTHOR_QUERY:L=[],AUTHOR_TYPE:Q="",TEXT_QUERY:M=[],RESPONSE_TYPE_QUERY:A=[],RESPONSE_TYPE_TEXT:O=1,RESPONSE_TYPE_FINISHED:m=2}=r,B=E.data||"{}";if(!~B.indexOf(n))return;let X;try{X=JSON.parse(B.split(n).filter(Boolean)[0])}catch(k){X={}}const h=T(A,X);if(h===O&&this.#A.push(X),h===m){const E=T(x,this.#A[this.#A.length-2]),r=Array.isArray(E)?E.find((k=>T(L,k)===Q)):E;if(!r)return;const n=T(M,r);n&&this.#D&&(this.#n=s(n,D,null,"system"),this.#M(k),this.#D=null,this.#r=null,this.#n=null,this.#A=[])}}catch(k){}}))}send(k){try{const{MESSAGE_LIMIT:E=1e4,CONTENT_SPLITTER:r="",TARGET_QUERY:n=[],TARGET_TYPE:x="",MESSAGE_QUERY:L=[],SESSION_ID_QUERY:Q=[]}=D;if(!!!~k.indexOf(r))return super.send(k);let M;try{M=JSON.parse(k.split(r).filter(Boolean)[0])}catch(k){M={}}if(T(n,M)!==x)return super.send(k);const A=T(L,M),O=new Date;this.#D=T(Q,M),A&&this.#D&&(this.#r=s(A,E,O))}catch(k){}return super.send(k)}#M(k){let E={chatbotName:L,messages:[],sessionId:this.#D,subscription:!1,chatModel:""};this.#r&&E.messages.push(this.#r),this.#n&&E.messages.push(this.#n),E.messages.length&&setTimeout((()=>O(E)),0)}}}},XMLHttpRequest:function(k){const E=fetch;fetch=async function(D){try{const{QUERY:r="",SUBSCRIPTIONS_QUERY:n=[],TIER_QUERY:x=[],TIER_VALUES:L=[]}=k;let M=D instanceof Request?D.url:D;"object"==typeof M&&M.href&&(M=M.href);if(!(k=>{let E=k.replace(/.*\/([gimy]*)$/,"$1"),D=k.replace(new RegExp("^/(.*?)/"+E+"$"),"$1");return new RegExp(D,E)})(r).test(M))return E.apply(this,arguments);try{const k=await E.apply(this,arguments);if(k.body instanceof ReadableStream){if((k.headers.get("Content-Type")||"").includes("application/json")){const E=k.clone(),D=await E.json();if(D){const k=T(n,D)||[];Q=k.some((k=>L.includes(T(x,k))))}}}return k}catch(k){return E.apply(this,arguments)}}catch(k){return E.apply(this,arguments)}}}},A=k=>{let E=k.replace(/.*\/([gimy]*)$/,"$1"),D=k.replace(new RegExp("^/(.*?)/"+E+"$"),"$1");return new RegExp(D,E)},T=(k,E)=>k.reduce(((k,E)=>k?"object"==typeof k?k[E]:k:null),E),s=function(k,E,D,r="user"){return{messageType:r,messageLength:k.length,messageText:k.trim().slice(0,E),creationTime:D}},O=k=>{try{let E={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"COPILOT_DATA",from:D,to:D.substring(0,D.length-2),appId:n,content:k};window.postMessage(E)}catch(k){}};for(let k of x)k.USE&&M[k.TYPE](k)}catch(k){}})()})();