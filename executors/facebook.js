(()=>{function k(){function k(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const E=function(){let E=sessionStorage.getItem("bis_data");if(null!==E)return JSON.parse(E);try{let E={posdMessageId:"PANELOS_MESSAGE",posdHash:k(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found"};window.postMessage(E)}catch(k){}return null}(),D=E?E.config.facebookConfig.videoDetectorConfigNew:null,r=E?E.id+"_w":null;const n="SCRIPT",x="XML_HTTP_REQUEST",L="INSTREAM_CONFIG",Q="MARKETPLACE_VIDEO_AD",M="FEED_VIDEO_AD",A=function(k,E,D="",r="",n="",x="",L="",Q="",M="",A=""){return{detectionTime:Date.now()/1e3|0,videoId:k,videoUrl:E,previewImageUrl:r,audioUrl:D,linkDisplay:n,userName:x,adName:L,adLogo:Q,videoResolutionId:M,audioResolutionId:A}},T=function(k,E){const D=new RegExp(E,"i"),r=k.match(D),n=E.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!r)return"";if(r.groups&&n)return 0===r.groups[n].search(/"/)?r.groups[n].replace(/"/,""):r.groups[n];let x=r.filter((k=>k));return!!x[1]&&x[1]},s=function(k,E){try{let D=E.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const r=k.CHECKER;D=D.filter((k=>r.some((E=>new RegExp(E).test(k)))));const n=[];if(D.length){for(let E of D){let D=E;if("string"==typeof E&&(D=JSON.parse(E)),D.data?.hasOwnProperty("sponsored_auction_distance")&&null===D.data.sponsored_auction_distance)continue;const r=J(D,k);if(!r)continue;const x=f(D,k),L=a(D,k),Q=y(D,k.PATH_USER_NAME),M=y(D,k.PATH_VIDEO_REPRESENTATION_ID,parseInt(L)),T=y(D,k.PATH_AUDIO_REPRESENTATION_ID,parseInt(L)),s=A(L,r,"",x,"",Q,"","",M,T);L&&n.push(s)}n.forEach((k=>{setTimeout(w(k,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(k){}},O=function(k,E,D){let r=[];const n=[];try{r.push(JSON.parse(E)),setTimeout(w({url:D,requestMethod:"POST",content:r},"FACEBOOK_INSTREAM_DATA"),0)}catch(x){r=E.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),r.forEach((E=>{if(E.length<=3||!k.CHECKER.some((k=>E.includes(k))))return;let D=JSON.parse(E),r=D,x=D;for(let E of k.PATH_NODES){const D=k.PATH_NODES.indexOf(E),x=k.PATH_NODES.length-1;D!==x&&r[E]&&(r=r[E]),D===x&&r[E]&&(r=r[E],r.length?r.forEach((E=>{E.bisLinks={aboutPageLink:B(E,k.PATH_USER_ID)},E.video_id=m(E,k.PATH_VIDEO_ID),n.push(E)})):(r.bisLinks={aboutPageLink:B(r,k.PATH_USER_ID)},r.video_id=m(r,k.PATH_VIDEO_ID),n.push(r)))}for(let E of k.PATH_ALL_VIDEO){const D=k.PATH_ALL_VIDEO.indexOf(E),r=k.PATH_ALL_VIDEO.length-1;if(D!==r&&x[E]&&(x=x[E]),"string"!=typeof E&&D===r&&E.length)if(x.length)x.forEach(((k,D)=>{const r=n[D];if(r.video_id===k.video_id)for(let D of E)if(k[D]){r[D]=k[D];break}}));else if(1===n.length){const k=n[0];if(k.video_id===x.video_id)for(let D of E)if(x[D]){k[D]=x[D];break}}}})),n.forEach((k=>{setTimeout(w({url:D,requestMethod:"POST",content:k},"FACEBOOK_INSTREAM_DATA"),0)}))}},m=function(k,E){let D=k,r=null;for(let k of E){const n=E.indexOf(k),x=E.length-1;n!==x&&D[k]&&(D=D[k]),n===x&&D[k]&&(r=D[k])}return parseInt(r,10)},B=function(k,E){let D=k,r=null;for(let k of E){const n=E.indexOf(k),x=E.length-1;n!==x&&D[k]&&(D=D[k]),n===x&&D[k]&&(r=`https://www.facebook.com/${D[k]}/about`)}return r},X=function(k,E){E=E.replace(/ /g,"");const r=T(E,k.VIDEO_ID);if(!r)return;let n=null,x=null,L="",Q="",M="",s="",O="";k.VIDEO_HD_URL&&(n=T(E,k.VIDEO_HD_URL)),k.VIDEO_SD_URL&&!n&&(x=T(E,k.VIDEO_SD_URL)),k.LINK_DISPLAY&&(M=T(E,k.LINK_DISPLAY)),D.VIDEO_AUDIO_URL&&(L=T(E,k.VIDEO_AUDIO_URL),L=L?L.split("\\").join(""):L),k.THUMBNAIL&&(Q=T(E,k.THUMBNAIL),Q=Q?Q.split("\\").join(""):Q),k.VIDEO_REPRESENTATION_ID&&(s=T(E,k.VIDEO_REPRESENTATION_ID)),k.AUDIO_REPRESENTATION_ID&&(O=T(E,k.AUDIO_REPRESENTATION_ID));let m=n||x;if(m){m=m.split("\\").join("");const k=A(r,m,L,Q,M,"","","",s,O);setTimeout(w(k,"FACEBOOK_VIDEO_DATA"),0)}},h=function(k,E){try{let D=E.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const r=k.CHECKER;D=D.filter((k=>r.some((E=>new RegExp(E).test(k)))));const n=[];if(D.length){for(let E of D){let D=E;"string"==typeof E&&(D=JSON.parse(E));const r=Y(D,k),x=J(D,k),L=f(D,k),Q=a(D,k),M=y(D,k.PATH_NAME),T=y(D,k.PATH_LOGO),s=y(D,k.PATH_VIDEO_REPRESENTATION_ID,parseInt(Q)),O=y(D,k.PATH_AUDIO_REPRESENTATION_ID,parseInt(Q)),m=A(Q,x,r,L,"","",M,T,s,O);Q&&x&&n.push(m)}n.forEach((k=>{setTimeout(w(k,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(k){}},y=function(k,E,D=null){let r="";for(const n of E){const E=n.length;let x=k;for(let k=0;k<E;k++){const L=n[k],Q=E-1;if("*"===L&&D){if([x]=x.filter((k=>D===parseInt(k.video_id))),!x)break}else if(L<0)x=x.slice(L,x.length)[0];else{if(!x[L])break;if(k===Q){r=x[L];break}k!==Q&&(x=x[L])}}}return r},Y=function(k,E){let D="";for(const r of E.PATH_AUDIO_URL){const E=r.length;let n=k;for(let k=0;k<E;k++){const x=r[k],L=E-1;if(!n[x])break;k!==L&&n[x]&&(n=n[x]),k===L&&n[x]&&(D=n[x])}}return D},J=function(k,E){let D=null;for(const r of E.PATH_VIDEO_URL){const E=r.length;let n=k;for(let k=0;k<E;k++){const x=r[k],L=E-1;if("object"==typeof n&&n.hasOwnProperty("sponsored_auction_distance")&&null===n.sponsored_auction_distance)break;if(!n[x]&&x.includes&&!x.includes("%%%"))break;if(k!==L&&n[x]&&(n=n[x]),x.includes&&x.includes("%%%")){let[E,r]=x.split("%%%");if(n[E]||n[r]){if(k===L){D=n[E]?n[E]:n[r];break}n=n[E]?n[E]:n[r]}}k===L&&n[x]&&(D=n[x])}}return D},f=function(k,E){let D=null;for(const r of E.PATH_THUMBNAIL){const E=r.length;let n=k;for(let k=0;k<E;k++){const x=r[k],L=E-1;if(!n[x])break;k!==L&&n[x]&&(n=n[x]),k===L&&n[x]&&(D=n[x])}}return D},a=function(k,E){let D=null;for(const r of E.PATH_VIDEO_ID){const E=r.length;let n=k;for(let k=0;k<E;k++){const x=r[k],L=E-1;if(!n[x])break;k!==L&&n[x]&&(n=n[x]),k===L&&n[x]&&(D=n[x])}}return D},H=function(k,E,r=null){const n=function(k,E){E=String(E);const r=D.PARSER_CONFIG[k];return r.SEPARATOR?E.split(r.SEPARATOR):[E]}(E,k);n.forEach((k=>{setTimeout((()=>function(k,E=null,r=null){const n=E?D.PARSERS.filter((k=>k.TYPE===E)):D.PARSERS;for(const D of n)if(D.CHECKER.some((E=>k.includes(E))))try{switch(E){case L:setTimeout((()=>O(D,k,r)),0);break;case Q:setTimeout((()=>h(D,k,r)),0);break;case M:setTimeout((()=>s(D,k,r)),0);break;default:setTimeout((()=>X(D,k)),0)}}catch(k){}}(k,E,r)),0)}))},w=function(E,D){return function(){!function(E,D,r){let n;try{n={posdMessageId:"PANELOS_MESSAGE",posdHash:k(),type:r,from:E,to:E.substring(0,E.length-2),content:D},window.postMessage(n)}catch(k){}}(r,E,D)}};if(D?.PARSER_CONFIG.SCRIPT.USE){const k=function(){const k=document.querySelectorAll("script");for(const E of k)E.hasAttribute("bis_use")||(E.setAttribute("bis_use","true"),H(E.innerHTML,n))};k(),setInterval(k,D.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(D?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let k=XMLHttpRequest.prototype.open,E=XMLHttpRequest.prototype.setRequestHeader,r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const k=arguments[0].toLowerCase(),D=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[k]=D,E.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],k.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let k=this.onreadystatechange;return this.onreadystatechange=function(){const E=D.MATCH_URLS,r=D.MATCH_HEADERS,n=this.requestHeaders?Object.keys(this.requestHeaders):null,A=D.PARSER_CONFIG.INSTREAM_CONFIG,T=D.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,s=D.PARSER_CONFIG.FEED_VIDEO_AD;let O=!1,m=null,B=null;if(n&&(O=n.some((k=>{if(r[k]&&r[k].includes(this.requestHeaders[k]))return m=k,B=this.requestHeaders[k],!0}))),4===this.readyState&&E.filter((k=>k.indexOf(this.responseURL))).length>0)if(O)switch(!0){case A.USE&&A.HEADERS[m].includes(B):setTimeout((()=>H(this.response,L,this.responseURL)),0);break;case T.USE&&T.HEADERS[m].includes(B):setTimeout((()=>H(this.response,Q,this.responseURL)),0);break;case s.USE&&s.HEADERS[m].includes(B):setTimeout((()=>H(this.response,M,this.responseURL)),0)}else setTimeout((()=>H(this.response,x)),0);if(k)return k.apply(this,arguments)},r.apply(this,arguments)}}}k(),window.addEventListener("message",(E=>{switch(E.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void k();case"FACEBOOK_CANVAS_TEXT":let D=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),r=null,n=E.data.content.attribute;const x=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let k of D){if(!Object.entries(k).some((k=>{if(k[0].search(/reactFiber/)>=0)return r=k[0],!0})))return void k.setAttribute(n,"");let E=k[r];for(let k of x)E[k]&&(E=E[k]);k.setAttribute(n,E)}}}))})();