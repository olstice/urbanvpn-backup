(()=>{const k=(E=1,D=10,r=200)=>new Promise(((n,x)=>{const L=(()=>{const k=sessionStorage.getItem("bis_data");if(null!==k)return JSON.parse(k);return null})();return L?n(L):E>=D?x(new Error(`posd_log: ${(new Date).toLocaleString()} ERROR: (PosdMetaNetworkDetector) config not found after ${D} attempts`)):void setTimeout((()=>{n(k(E+1,D,r))}),r)}));(async()=>{try{const E=await k(),D=E?.config?`${E.id}_t`:null,r=E?.config?.aiMessagesConfig?.META_AI||{},n=document.head.querySelector("script[bis_use][id]")?.getAttribute("id")||"",{PARSERS:x=[],CHATBOT_NAME:L=""}=r,Q={XMLHttpRequest:function(k){let E=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(...D){const r=D[0],n=this,x=new Date;return n.addEventListener("readystatechange",(function(){try{if(4===n.readyState&&n.status>=200&&n.status<300){const{sentMessage:E,sessionId:D}=M(r,x,k.SEND_MESSAGE),L=A(n.responseText,k.RECEIVED_MESSAGE);m(E,L,D,k)}}catch(k){}})),E.call(this,...D)}}},M=(k,E,D)=>{const{MESSAGE_LIMIT:r=1e4,DATA_QUERY:n="",MESSAGE_QUERY:x=[],SESSION_ID_QUERY:L=[]}=D;let Q=null,M=null;if("string"==typeof k&&k.includes(`${n}=`)){Q=new URLSearchParams(k).get(n)}if(k instanceof FormData&&(Q=k.get(n)),Q)try{M=JSON.parse(Q)}catch(k){}if(M){const k=s(x,M),E=s(L,M),D=new Date;if(!T(E))return{};if(E&&k)return{sentMessage:O(k,r,D),sessionId:E}}return{}},A=(k,E)=>{try{const{MESSAGE_LIMIT:D=3e4,DATA_FILTER:r="",MESSAGE_QUERY:n=[],CONVERSATION_ID_QUERY:x=[]}=E,L=k.split("\n").filter((k=>k.trim().startsWith(r))),Q=L[L.length-1],M=JSON.parse(Q),A=s(x,M);if(!T(A))return;const m=s(n,M);return m?O(m,D,null,"system"):null}catch(k){return null}},T=k=>self.location.href.includes(k),s=(k,E)=>k.reduce(((k,E)=>k?"object"==typeof k?k[E]:k:null),E),O=function(k,E,D,r="user"){return{messageType:r,messageLength:k.length,messageText:k.trim().slice(0,E),creationTime:D}},m=function(k,E,D){const r={chatbotName:L,messages:[],sessionId:D,subscription:!1,chatModel:""};k&&r.messages.push(k),E&&r.messages.push(E),r.messages.length&&setTimeout((()=>B(r)),0)},B=k=>{try{let E={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"META_AI_DATA",from:D,to:D.substring(0,D.length-2),appId:n,content:k};window.postMessage(E)}catch(k){}};for(let k of x)k.USE&&Q[k.TYPE](k)}catch(k){}})()})();