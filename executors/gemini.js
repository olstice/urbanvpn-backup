(()=>{const k=(E=1,D=10,r=200)=>new Promise(((n,x)=>{const L=(()=>{const k=sessionStorage.getItem("bis_data");return k?JSON.parse(k):null})();return L?n(L):E>=D?x(new Error(`posd_log: ${(new Date).toLocaleString()} ERROR: (PosdGeminiMessagesCollector) config not found after ${D} attempts`)):void setTimeout((()=>{n(k(E+1,D,r))}),r)}));(async()=>{try{const E=()=>(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22);let D=null,r=null;const n=function(){window.addEventListener("message",(k=>{if("GEMINI_PROTECTION_STATUS_RESPONSE"===k.data?.type)D=k.data.content})),window.postMessage({posdMessageId:"PANELOS_MESSAGE",posdHash:E(),type:"GEMINI_PROTECTION_STATUS",from:L,to:L.substring(0,L.length-2),appId:M,content:""})},x=await k(),L=x?.config?`${x.id}_t`:null,Q=x?.config?.aiMessagesConfig?.GEMINI||{},M=document.head.querySelector("script[bis_use][id]")?.getAttribute("id")||"",{PARSERS:A=[],CHATBOT_NAME:T="",QUERY_GET_CHAT_MODEL:s,QUERY_GET_SUBSCRIPTION:O,PAID_SUBSCRIPTION_VALUES:m,AI_FEATURES:B}=Q;n();const X=k=>{try{let D={posdMessageId:"PANELOS_MESSAGE",posdHash:E(),type:"GEMINI_DATA",from:L,to:L.substring(0,L.length-2),appId:M,content:k};window.postMessage(D)}catch(k){}},h=function(){return document.querySelector(s)?.textContent},y=function(){const k=document.querySelector(O)?.textContent;return m.some((E=>E===k?.toLowerCase()))},Y=function(k,E,n,x){let L={chatbotName:T,chatModel:h(),subscription:y(),messages:[]},Q={},M={};if(k?.length){let n=decodeURIComponent(k),M=n.split(x.GENERAL_DATA.SEPARATOR_PARAMETERS)?.[0];if(M){let k=M.replace(new RegExp(x.GENERAL_DATA.REPLACEMENT_PARAMETER,"g"),"");if(r)L.sessionId=r;else{let E=JSON.parse(JSON.parse(k)?.filter((k=>k)))?.filter((k=>k))?.[2]?.[0],D=self.location.href.match(new RegExp(x.GENERAL_DATA.REGEXP_SESSION_ID_FROM_URL))?.groups?.sessionId;L.sessionId=E.length?E.replace(new RegExp(x.GENERAL_DATA.REPLACEMENT_PREFIX_SESSION_ID),""):D,r=null}D||w(Q,k,E,x.SENT_MESSAGE)}}a(M,n,x.RECEIVED_MESSAGE),Q?.messageText&&L.messages.push(Q),M?.messageText&&L.messages.push(M),L.messages.length&&setTimeout((()=>X(L)),0)},J=function(k,E,D,r){try{Y(k,D,E,r)}catch(k){}},f=function(k){try{const E=JSON.parse(k)[0][2];return JSON.parse(E)[4][0][1][0]}catch(k){return""}},a=function(k,E,D){if(!E?.length)return;let r="",n=E.replace(new RegExp(D.REGEXP_REMOVE_GARBAGE),"").split(new RegExp(D.REGEXP_SPLITER)).map((k=>k.trim())).filter((k=>k)),x=[0,0];for(let k of n){let E=n.indexOf(k);x[1]<k.length&&(x[1]=k.length,x[0]=E)}if(D.RED_FLAG_VALUES_FOR_MEDIA.some((k=>n[x[0]].includes(k))))return;if(r=f(n[x[0]]),r?.length)return void H(k,r,D);let L=new RegExp(D.REGEXP_GET_MESSAGE_TEXT);r=n[x[0]].match(L)?.groups?.message,r&&H(k,r,D)},H=function(k,E,D){k.messageText=E,k.messageType=D.MESSAGE_TYPE,k.creationTime=null,N(k,D.MESSAGE_LENGTH||3e4)},w=function(k,E,D,r){try{b(k,E,D,r)}catch(k){}},b=function(k,E,D,r){let n=JSON.parse(JSON.parse(E)?.filter((k=>k)))?.filter((k=>k))?.[0]?.[0];n?.length?(k.messageText=n,k.messageType=r.MESSAGE_TYPE,k.creationTime=D,N(k,r.MESSAGE_LIMIT||1e4)):k=null},N=function(k,E){let D=k.messageText,r=D.split("");"\\"===r[r.length-1]&&(r[r.length-1]="",D=r.join("")),k.messageText=D.trim().slice(0,E),k.messageLength=D.length},K=function(k,E,D){return new RegExp(D.REGEXP_URL_CHECK).test(k)&&E===D.REQUEST_METHOD},c=function(k,E,D){return new Promise((n=>{if(!k?.length)return void n(!0);let x,L=B?.DATA_PROTECTION?.MAX_DELAY_TIMEOUT||1e4,Q=setTimeout((()=>{window.removeEventListener("message",x),n(!0)}),L),M={chatbotName:T,chatModel:h(),subscription:y(),startDelayTime:(new Date).getTime(),maxDelayTime:L,messages:[]},A={};try{let L=decodeURIComponent(k),T=L.split(D.GENERAL_DATA.SEPARATOR_PARAMETERS)?.[0];if(T){let k=T.replace(new RegExp(D.GENERAL_DATA.REPLACEMENT_PARAMETER,"g"),""),n=JSON.parse(JSON.parse(k)?.filter((k=>k)))?.filter((k=>k))?.[2]?.[0],x=self.location.href.match(new RegExp(D.GENERAL_DATA.REGEXP_SESSION_ID_FROM_URL))?.groups?.sessionId;M.sessionId=n.length?n.replace(new RegExp(D.GENERAL_DATA.REPLACEMENT_PREFIX_SESSION_ID),""):x,r=M.sessionId,w(A,k,E,D.SENT_MESSAGE)}A?.messageText&&M.messages.push(A),x=function(k){switch(k.data?.type){case"AI_FEATURES_PROTECTION_CHECK_RESPONSE":case"AI_FEATURES_PROTECTION_NO_WARNINGS":clearTimeout(Q),window.removeEventListener("message",x),n(k.data.result);break;case"AI_FEATURES_PROTECTION_CLEAR_TIMEOUT":clearTimeout(Q)}}.bind(this),window.addEventListener("message",x),X(M)}catch(k){clearTimeout(Q),n(!0)}}))},i={XMLHttpRequest:function(k){const E=XMLHttpRequest.prototype.open,r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(k,D){return this._requestMethod=k,this._requestUrl=D,E.apply(this,arguments)},XMLHttpRequest.prototype.send=async function(E){let n=this.onreadystatechange;try{const r=new Date,x=K(this._requestUrl,this._requestMethod,k);if(!(!x||!D||await c(E,r,k)))throw new Error(B?.DATA_PROTECTION?.MESSAGE_ABORTED_REQUEST||"");this.onreadystatechange=function(){try{4===this.readyState&&x&&setTimeout(J.bind(this,E,this.responseText,r,k),0)}catch(k){}if(n)return n.apply(this,arguments)}}catch(k){return this.abort(),void location.reload()}return r.apply(this,arguments)}}};(function(){for(let k of A)k.USE&&i[k.TYPE](k)})()}catch(k){}})()})();